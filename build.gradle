buildscript {
	repositories {
		mavenCentral()
	}
	dependencies {
		classpath 'org.jetbrains.kotlin:kotlin-gradle-plugin:1.3.21'
	}
}

apply plugin: 'kotlin2js'

repositories {
	mavenCentral()
}

dependencies {
	compile 'org.jetbrains.kotlin:kotlin-stdlib-js:1.3.21'
}

task assembleWeb(type: Sync) {
	configurations.compile.each { File file ->
		from(zipTree(file.absolutePath), {
			includeEmptyDirs = false
			include { fileTreeElement ->
				def path = fileTreeElement.path
				path.endsWith(".js") && (path.startsWith("META-INF/resources/") || 
					!path.startsWith("META-INF/"))
			}
		})
	}
	from compileKotlin2Js.destinationDir
	into "${projectDir}/web"

	dependsOn classes
}

assemble.dependsOn assembleWeb
